<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ problem.title }} - Mathforces</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], processEscapes: true },
            options: { ignoreHtmlClass: 'tex2jax_ignore', processHtmlClass: 'tex2jax_process' }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .problem-statement { font-size: 1.1rem; line-height: 1.7; color: #2d3436; }
        .code-input { font-family: 'Courier New', monospace; background-color: #fdfdfd; }
        .animate-pulse { animation: pulse 2s infinite; color: #dc3545; font-weight: 700; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4 shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="{% url 'problem_list' %}">MATHFORCES</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{% url 'problem_list' %}">Archive</a>
                <a class="nav-link" href="{% url 'contest_list' %}">Contests</a>
                <a class="nav-link" href="{% url 'submission_list' %}">Submissions</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-9">
                
                {% if active_contest %}
                <div class="alert alert-warning shadow-sm d-flex justify-content-between align-items-center mb-4 border-0 rounded-3">
                    <span><strong>Active Contest!</strong> This problem is part of: <b>{{ active_contest.title }}</b></span>
                    <a href="{% url 'contest_dashboard' active_contest.id %}" class="btn btn-sm btn-dark">Go to Dashboard</a>
                </div>
                {% endif %}

                <div class="card shadow-sm border-0 mb-4 rounded-3">
                    <div class="card-header bg-white py-3 border-bottom d-flex justify-content-between align-items-center">
                        <h2 class="mb-0 fw-bold text-dark">{{ problem.title }}</h2>
                        <span class="badge {{ problem.difficulty_level|default:'bg-secondary' }} px-3 py-2">
                            Rating: {{ problem.difficulty }}
                        </span>
                    </div>
                    <div class="card-body bg-white p-4">
                        <div class="problem-statement mb-5 tex2jax_process">
                            {{ problem.description|linebreaks }}
                        </div>

                        <hr class="my-4">

                        {% if result %}
                            <div class="alert {% if 'ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾' in result or 'Right' in result %}alert-success{% else %}alert-danger{% endif %} fw-bold shadow-sm">
                                {% if 'ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾' in result %}Correct Answer!{% else %}Wrong Answer!{% endif %}
                            </div>
                        {% endif %}

                        {% if is_banned %}
                            <div class="alert alert-danger shadow-sm text-center">
                                <h4>ðŸš« Disqualified</h4>
                                <p>You are banned from submitting solutions.</p>
                                <small>Reason: {{ user.profile.reason }}</small>
                            </div>
                        {% else %}
                            <form method="POST" class="mt-4">
                                {% csrf_token %}
                                <div class="mb-4">
                                    <label class="form-label fw-bold text-secondary">Answer</label>
                                    <input type="text" name="answer" class="form-control form-control-lg border-primary code-input" placeholder="Enter your numeric or text answer" required autocomplete="off">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="form-label fw-bold text-secondary">
                                        Solution / Logic
                                        {% if active_contest %}
                                            <span class="animate-pulse ms-2 small text-uppercase">(Required during contest)</span>
                                        {% else %}
                                            <span class="text-muted fw-normal small">(Optional)</span>
                                        {% endif %}
                                    </label>
                                    <textarea name="solution" class="form-control code-input" rows="5" 
                                              placeholder="Briefly explain your approach..." 
                                              {% if active_contest %}required{% endif %}></textarea>
                                </div>

                                <div class="d-flex gap-3">
                                    <button type="submit" class="btn btn-primary btn-lg px-5 shadow-sm fw-bold">Submit</button>
                                    {% if active_contest %}
                                        <a href="{% url 'contest_dashboard' active_contest.id %}" class="btn btn-outline-dark btn-lg">Back to Contest</a>
                                    {% else %}
                                        <a href="{% url 'problem_list' %}" class="btn btn-outline-secondary btn-lg">Back to Archive</a>
                                    {% endif %}
                                </div>
                            </form>
                        {% endif %}
                    </div>
                </div>

                {% if not user.is_authenticated %}
                <div class="alert alert-info border-0 shadow-sm text-center">
                    Please <a href="{% url 'login' %}" class="fw-bold text-decoration-none">Login</a> to save your progress.
                </div>
                {% endif %}

            </div>
        </div>
    </div>
    
    <footer class="py-5 text-center text-muted small mt-5">
        &copy; 2026 Mathforces Engine. Built for competitive minds.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>